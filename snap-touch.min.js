"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}(),SnapTouch=function(){function t(e){_classCallCheck(this,t),this.active=!1,this.el={},this.el.container=document.getElementById(e),this.el.animator=this.el.container?this.el.container.querySelector(".slides"):void 0,this.el.slides=this.el.animator?this.el.animator.querySelectorAll(".slide"):[],this.el.anchors=this.el.animator?this.el.animator.querySelectorAll("a[href]"):[],this.events={},this.params={slideWidth:void 0,slideTotal:void 0,velocity:void 0,amplitude:void 0,posX:void 0,targetX:void 0,lastPosX:void 0,lastTouchX:void 0,firstTimestamp:void 0,lastTimestamp:void 0,ticker:void 0,activeIndex:void 0,isClick:void 0,isEasing:void 0,hasMoved:void 0}}return _createClass(t,[{key:"activate",value:function(){this.active=!0,this.addClass(this.el.container,"active")}},{key:"deactivate",value:function(){this.active=!1,this.removeClass(this.el.container,"active")}},{key:"create",value:function(){this.el.container&&this.el.slides.length>=0&&(this.dispatchEvent("SnapTouch.created"),this.activate(),this.getActiveIndex(),this.bindEvents(),this.resize())}},{key:"destroy",value:function(){this.deactivate(),this.resetParams(),this.removeAllEvents(),this.unsetActiveLinks(),this.unsetDimensions(),this.dispatchEvent("SnapTouch.destroyed")}},{key:"hasClass",value:function(t,e){return t.className.indexOf(e)>-1}},{key:"addClass",value:function(t,e){t.className=t.className+" "+e+" "}},{key:"removeClass",value:function(t,e){var s=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(s," ")}},{key:"getActiveIndex",value:function(){var t=this,e=0,s=function(e){return t.hasClass(e,"active")},i=Array.prototype.filter.call(this.el.anchors,s);if(i.length>0){var a=i[0];e=Array.prototype.slice.call(this.el.anchors).indexOf(a)}return this.setActiveIndex(e),e}},{key:"setActiveIndex",value:function(t){this.params.activeIndex=t,this.dispatchEvent("SnapTouch.activeIndexChanged",{bubbles:!1,cancelable:!1,detail:{index:this.params.activeIndex}})}},{key:"on",value:function(t,e,s){var i=this,a=t._key||Math.random().toString(36).substring(7);t._key=a,this.events.hasOwnProperty(a)||(this.events[a]={}),this.events[a].hasOwnProperty(e)||(this.events[a][e]={target:t,listeners:[]});var n=function(e){e._key=a,e._target=t,s.call(i,e)};this.events[a][e].listeners.push(n),t.addEventListener(e,n)}},{key:"off",value:function(t){var e=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=t._key,a=function(t,s){for(var i=e.events[t][s].target,a=e.events[t][s].listeners,n=0;n<a.length;n++)i.removeEventListener(s,a[n]),e.events[t][s].listeners.splice(n,1);0===e.events[t][s].listeners.length&&delete e.events[t][s],0===Object.keys(e.events[t]).length&&delete e.events[t]};if(this.events.hasOwnProperty(i))if(s)a(i,s);else{var n=this.events[i];for(var o in n)n.hasOwnProperty(o)&&a(i,o)}}},{key:"removeAllEvents",value:function(){for(var t in this.events)if(this.events.hasOwnProperty(t))for(var e in this.events[t])this.events[t].hasOwnProperty(e)&&this.off(this.events[t][e].target,e)}},{key:"resetParams",value:function(){for(var t in this.params)this.params.hasOwnProperty(t)&&(this.params[t]=void 0)}},{key:"setActiveLink",value:function(t){this.unsetActiveLinks(),this.addClass(t,"active")}},{key:"unsetActiveLinks",value:function(){for(var t=0;t<this.el.anchors.length;t++)this.removeClass(this.el.anchors.item(t),"active")}},{key:"delayLocationChange",value:function(t){var e=this,s=function(t){e.params.isEasing?e.delayLocationChange(t):window.location.href=t};window.setTimeout(s.bind(this,t),100)}},{key:"preventDefault",value:function(t){return t.preventDefault(),!1}},{key:"addEventListener",value:function(t,e){this.el.container.addEventListener(t,e)}},{key:"dispatchEvent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{bubbles:!1,cancelable:!1,detail:null};if(!("CustomEvent"in window&&"function"==typeof window.CustomEvent)){var s=function(t,e){var s=document.createEvent("CustomEvent");return s.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),s};s.prototype=window.Event.prototype,window.CustomEvent=s}var i=new window.CustomEvent(t,e);return this.el.container.dispatchEvent(i),i}},{key:"bindEvents",value:function(){var t=this;this.on(this.el.animator,"dragstart",this.preventDefault),this.on(this.el.animator,"touchstart",this.touchStart),this.on(this.el.animator,"mousedown",this.touchStart),this.on(window,"resize",this.resize);for(var e=0;e<this.el.anchors.length;e++)this.on(this.el.anchors.item(e),"click",function(e){t.preventDefault(e),t.params.isClick&&(t.setActiveLink(e._target),t.getActiveIndex(),t.easeTowardsTarget(),t.delayLocationChange(e._target.href))});this.on(this.el.container,"SnapTouch.resized",function(e){t.setPosition(e.detail.slideWidth*t.params.activeIndex*-1)})}},{key:"eventCoords",value:function(t){if(["touchmove","touchstart","touchend"].indexOf(t.type)>-1){var e=t.targetTouches[0]||t.changedTouches[0];return{x:e.clientX,y:e.clientY}}return{x:t.clientX,y:t.clientY}}},{key:"prefixed",value:function(t,e){for(var s=["","webkit","Moz","MS","ms","o"],i=e[0].toUpperCase()+e.slice(1),a=0;a<s.length;a++){var n=s[a],o=n?n+i:e;if(o in t)return o;a++}}},{key:"startTracking",value:function(){this.params.ticker&&this.stopTracking(),this.params.ticker=window.setInterval(this.track.bind(this),100),this.on(document,"touchmove",this.touchMove),this.on(document,"mousemove",this.touchMove),this.on(document,"touchend",this.touchEnd),this.on(document,"mouseup",this.touchEnd),this.dispatchEvent("SnapTouch.trackingStart")}},{key:"stopTracking",value:function(){window.clearInterval(this.params.ticker),delete this.params.ticker,this.off(document),this.dispatchEvent("SnapTouch.trackingEnd")}},{key:"track",value:function(){var t=Date.now(),e=t-this.params.lastTimestamp,s=this.params.posX-this.params.lastPosX,i=1e3*s/(1+e);this.params.velocity=.8*i+.2*this.params.velocity,this.dispatchEvent("SnapTouch.tracking",{bubbles:!1,cancelable:!1,detail:{now:t,timeElapsed:e,delta:s,velocity:this.params.velocity,posX:this.params.posX,lastPosX:this.params.lastPosX,lastTimestamp:this.params.lastTimestamp}}),this.params.lastPosX=this.params.posX,this.params.lastTimestamp=t}},{key:"setDimensions",value:function(){this.el.animator.style.width=this.params.slideWidth*this.params.slideTotal+"px";for(var t=0;t<this.params.slideTotal;t++)this.el.slides.item(t).style.width=this.params.slideWidth+"px"}},{key:"unsetDimensions",value:function(){this.el.animator.style.width=null;for(var t=0;t<this.params.slideTotal;t++)this.el.slides.item(t).style.width=null}},{key:"getPosition",value:function(){return this.params.posX}},{key:"setPosition",value:function(t){if(this.getPosition()!==t){var e=this.params.slideWidth*-(this.params.slideTotal-1),s=this.el.animator.style,i=this.prefixed(s,"transform");this.params.posX=t>0?0:t<e?e:t,this.params.hasMoved=!0,s[i]="translate("+this.params.posX+"px, 0)",this.dispatchEvent("SnapTouch.positionChanged",{bubbles:!1,cancelable:!1,detail:{posX:this.params.posX}})}}},{key:"getTargetPosition",value:function(){this.params.targetX=this.params.posX,(this.params.velocity>10||this.params.velocity<-10)&&(this.params.amplitude=.8*this.params.velocity,this.params.targetX=this.params.posX+this.params.amplitude);var t=this.params.slideWidth;this.params.targetX=Math.round(this.params.targetX/t)*t}},{key:"easePosition",value:function(){if(this.params.amplitude){var t=Date.now()-this.params.lastTimestamp,e=-this.params.amplitude*Math.exp(-t/325),s=this.params.slideWidth*-(this.params.slideTotal-1);this.params.isEasing=this.params.posX>s&&this.params.posX<0&&(e>5||e<-5),this.params.isEasing?(this.setPosition(this.params.targetX+e),this.requestAnimation(this.easePosition)):(this.setPosition(this.params.targetX),this.dispatchEvent("SnapTouch.easePositionEnd",{bubbles:!1,cancelable:!1,detail:{posX:this.params.posX}}))}}},{key:"easeTowardsTarget",value:function(){this.params.targetX=this.params.slideWidth*this.params.activeIndex*-1,this.params.amplitude=this.params.targetX-this.params.posX,this.requestAnimation(this.easePosition)}},{key:"requestAnimation",value:function(t){t=t.bind(this),window.requestAnimationFrame?window.requestAnimationFrame(t):window.setTimeout(t,10)}},{key:"resize",value:function(){this.unsetDimensions(),this.params.slideWidth=this.el.slides.item(0).getBoundingClientRect().width,this.params.slideTotal=this.el.slides.length,this.setDimensions(),this.dispatchEvent("SnapTouch.resized",{bubbles:!1,cancelable:!1,detail:{slideWidth:this.params.slideWidth,slideTotal:this.params.slideTotal}})}},{key:"touchStart",value:function(t){this.params.velocity=0,this.params.amplitude=0,this.params.posX=this.params.posX||0,this.params.lastPosX=this.params.posX,this.params.firstTimestamp=Date.now(),this.params.lastTimestamp=this.params.firstTimestamp,this.params.lastTouchX=this.eventCoords(t).x,this.params.isClick=!1,this.params.isEasing=!1,this.params.hasMoved=!1,this.startTracking()}},{key:"touchMove",value:function(t){var e=this.eventCoords(t).x,s=e-this.params.lastTouchX;(s>2||s<-2)&&(this.params.lastTouchX=e,this.setPosition(this.params.posX+s))}},{key:"touchEnd",value:function(){this.stopTracking(),this.getTargetPosition(),this.params.amplitude=this.params.targetX-this.params.posX,this.params.lastTimestamp=Date.now(),this.requestAnimation(this.easePosition);var t=this.params.lastTimestamp-this.params.firstTimestamp;this.params.isClick=!this.params.hasMoved&&t<300}}]),t}();"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports&&(module.exports=SnapTouch),"undefined"!=typeof window&&(window.SnapTouch=SnapTouch);